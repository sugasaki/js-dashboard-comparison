!function(t,i){"use strict";function r(t){var i=this;i.builds=t,i.headingClass=function(t){return"travis-"+t.state}}function e(t){t.widget("travis-history",{title:"Travis CI History",description:"Build history from Travis CI",category:"Travis CI",templateUrl:"{widgetsPath}/travis/src/history/history.html",resolve:{builds:["Travis","config",function(t,i){return i.username&&i.repository?t.getBuildHistory(i.username,i.repository):null}]},controller:"HistoryController",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/travis/src/edit/edit.html"}})}function a(t,i,r){function e(t,i,e){return r+"/"+t+"/"+i+"/builds/"+e.id}function a(t){var i;return t.pull_request?i="PR #"+t.pull_request_number+" "+t.pull_request_title:t.commit&&t.commit.message&&(i=t.commit.message),i}function o(t,i){return function(r){var o={};angular.forEach(r.commits,function(t){o[t.id]=t});var s=r.builds;return angular.forEach(s,function(r){r.commit_id&&(r.commit=o[r.commit_id]),r.description=a(r),r.htmlUrl=e(t,i,r)}),s}}function s(r,e){return t({method:"GET",url:i+"/repos/"+r+"/"+e+"/builds",headers:{Accept:"application/vnd.travis-ci.2+json"}}).then(function(t){return t.data}).then(o(r,e))}return{getBuildHistory:s}}angular.module("adf.widget.travis",["adf.provider","angular-md5"]),angular.module("adf.widget.travis").run(["$templateCache",function(t){t.put("{widgetsPath}/travis/src/edit/edit.html",'<form role=form><div class=form-group><label for=username>Username</label> <input type=text class=form-control id=username ng-model=config.username placeholder="Enter username"></div><div class=form-group><label for=repository>Repository</label> <input type=text class=form-control id=repository ng-model=config.repository placeholder="Enter repository"></div></form>'),t.put("{widgetsPath}/travis/src/history/history.html",'<div><div ng-if=!config.repository class="alert alert-info">Please configure the widget</div><div ng-if=config.repository><ul class=media-list><li class=media ng-repeat="build in vm.builds"><div class=media-left><img class="media-object img-thumbnail" ng-src="http://www.gravatar.com/avatar/{{ build.commit.author_email | gravatar }}?s=64&d=identicon"></div><div class=media-body><h4 class=media-heading><a href={{build.htmlUrl}} ng-class=vm.headingClass(build) target=_blank>{{build.number}} {{build.state}}</a></h4><p>{{build.description}}</p><small>{{build.commit.author_name}}, {{build.started_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>')}]),angular.module("adf.widget.travis").controller("HistoryController",r),r.$inject=["builds"],angular.module("adf.widget.travis").config(e),e.$inject=["dashboardProvider"],angular.module("adf.widget.travis").constant("travisEndpoint","https://api.travis-ci.org").constant("travisHtmlEndpoint","https://travis-ci.org").factory("Travis",a),a.$inject=["$http","travisEndpoint","travisHtmlEndpoint"]}(window);